<script>
	stocks_for_js = <%= @stocks_for_js %>
</script>

<div class="container">
<%= render 'user_profile/left_menu' %>

<%= form_tag buy_refresh_cart_path, :method => "put" do %>
	<h1>Carrito de compras</h1>
	<h4>Precio Carrito (Subtotal): <%= number_to_currency(@shopping_cart.price) %></h4>
	<% if @shopping_cart.shopping_cart_items.size > 0 %>
		<% @shopping_cart.shopping_cart_items.each do |shopping_cart_item| %>
		<div class="panel panel-default">
		  <div class="panel-body">
			<%= fields_for "shopping_cart_items[]", shopping_cart_item do |f| %>
					<div class="col-md-1">
						<%= link_to image_tag(shopping_cart_item.purchasable.small_image, 
												:alt => shopping_cart_item.purchasable.introduction, class: "img-thumbnail"), 
												dress_ver_path(:type => shopping_cart_item.purchasable.dress_type.name, 
												:slug => shopping_cart_item.purchasable.slug) %>
					</div>			
					<div class="col-md-6">
						<table width="100%">
							<tr>
								<th style="">Descripci√≥n</th>
								<th style="">Precio Unitario</th>
								<th style="">Talla</th>
								<th style="">Cantidad</th>
							</tr>
							<tr>
								<td style="vertical-align:top"><%= raw shopping_cart_item.purchasable.description.gsub(/\n/, '<br/>') if !shopping_cart_item.purchasable.description.nil? %></td>
								<td style="vertical-align:top"><%= number_to_currency shopping_cart_item.purchasable.price %></td>
								<td style="vertical-align:top">
									<% shopping_cart_item.purchasable.dress_stock_sizes.each do |dress_stock_size| %>
										<% if !dress_stock_size.stock.blank? %>
											<% if dress_stock_size.stock > 0 %>
												<% if shopping_cart_item.size.blank? %>
													<%= f.radio_button(:size, dress_stock_size.size.name, :checked => dress_stock_size.first_with_stock?, :class => "buy_radio_button_cart") %> <%= dress_stock_size.size.name %>
												<% else %>
													<%= f.radio_button(:size, dress_stock_size.size.name, :checked => dress_stock_size.size.name == shopping_cart_item.size, :class => "buy_radio_button_cart") %> <%= dress_stock_size.size.name %>
												<% end %>
											<% end %>
										<% end %>
									<% end %>
								</td>
								<td style="vertical-align:top">
									<% if @first_max[shopping_cart_item.id.to_s].blank? %>
										<%= f.select(:quantity, 1..5) %>
									<% else %>
										<%= f.select(:quantity, 1..@first_max[shopping_cart_item.id.to_s]) %>
									<% end %>
								</td>
							</tr>
						</table>
					</div>
					<div class="col-md-3">
						<%= link_to image_tag('shopping_cart/remove-from-cart-small.jpeg', :class => 'image_button', alt: 'Eliminar'), 
							buy_remove_from_cart_path(:shopping_cart_item_id => shopping_cart_item.id), method: :post %>
					</div>
				</div>
			</div>
			<% end %>
		<% end %>
		<div class="row">
			<div class="col-lg-offset-9 col-lg-3">
			<%= submit_tag "Pagar carrito de compras", :go_to_buy_details => true, class: "btn btn-primary" %> 
			<%= image_tag "loading.gif", :class => :select_loading, :style => "display:none;" %>
			</div>
		</div>
	<% else %>
		  <%= render "layouts/nothing_to_show", :message => 'No has agregado Items al Carrito de Compras' %>
	<% end %>
<% end %>
	<div class="row" style="margin-top:15px">
		<div class="col-lg-12">
			<form action="<%= dresses_search_path %>" method="get">
			  <div class="input-group">
						<%= text_field_tag(:q, @search_text, :placeholder => 'o sigue agregando otros productos', :class => "form-control input-md") %>
			       <span class="input-group-btn">
							<%= submit_tag("Buscar", :name => nil, class: "btn btn-default") %>
			  		 </span>
			  </div><!-- /input-group -->
			</form>
		</div>
	</div>
</div>